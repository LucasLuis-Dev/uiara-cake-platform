// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id        String   @id @default(uuid())
  name      String
  phone     String
  whatsapp  String?
  address   String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  orders Order[]

  @@map("customers")
}

model Flavor {
  id        String      @id
  name      String
  type      FlavorType
  active    Boolean     @default(true)
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")

  ordersAsFilling Order[] @relation("filling")
  ordersAsDough   Order[] @relation("dough")

  @@map("flavors")
}

model Order {
  id             String         @id @default(uuid())
  customerId     String         @map("customer_id")
  fillingId      String         @map("filling_id")
  doughId        String         @map("dough_id")
  size           Size
  coverageType   CoverageType   @map("coverage_type")
  orderDate      DateTime       @default(now()) @map("order_date")
  deliveryDate   DateTime       @map("delivery_date")
  totalValue     Decimal        @map("total_value") @db.Decimal(10, 2)
  status         OrderStatus    @default(PENDING)
  observations   String?
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  googleCalendarEventId String?

  customer Customer @relation(fields: [customerId], references: [id])
  filling  Flavor   @relation("filling", fields: [fillingId], references: [id])
  dough    Flavor   @relation("dough", fields: [doughId], references: [id])

  @@map("orders")
}

enum Size {
  PP
  P
  M
  G
  GG
}

enum FlavorType {
  FILLING
  DOUGH
}

enum CoverageType {
  CHANTILLY
  GANACHE
}

enum OrderStatus {
  PENDING
  CONFIRMED
  IN_PRODUCTION
  READY
  DELIVERED
  CANCELLED
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(ADMIN)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

enum UserRole {
  ADMIN
}
